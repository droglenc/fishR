---
title: "Mean Weights at Ages From Lengths"
layout: post
date: "August 9, 2017"
output:
  html_document
tags:
- Weight_Length
- Mean_Weight
---
```{r eval=FALSE, echo=FALSE}
## FOR COMPILING FOR THE WEBSITE
## Make sure to setwd to source file location
source("rmd2md.R")
rmd2md("2017-8-9-MeanWeights")
```

```{r setup, echo=FALSE, results='hide', message=FALSE}
library(knitr)
knit_hooks$set(par1 = function(before, options, envir) {
  if (before) par(mar=c(3.5,3.5,1,1),mgp=c(2.1,0.4,0),tcl=-0.2)
})
opts_chunk$set(dev="png",tidy=FALSE,fig.width=4,fig.height=4,par1=TRUE)
options(show.signif.stars=FALSE)

library(FSA)
library(dplyr)
library(captioner)
figs <- captioner(prefix="Figure")
figs("Explore1","Histograms of lengths (upper left) and weights (upper right) and scatterplots of weight versus length (lower left) and length versus age (lower right). The line in the weight versus length scatterplot is the weights modeled without random error.")
figs("NormEx","Histograms of 1000 lengths simulated from a normal distribution (left) and weigths predicted from those lengths with a weight-length regression (right) demonstrating how the normally distributed lengths will become right-skewed weights.")
tabs <- captioner(prefix="Table")
tabs("Sum1Tab","Summary table using weights without any error and no correction for the predicted mean weights.")
tabs("Sum2Tab","Summary table using weights with a small amount of error and no correction for the predicted mean weights.")
tabs("Simulation1","Mean percentage difference in uncorrected predicted mean and true mean weights by age class for 1000 simulations.")
tabs("Simulation2","Mean percentage difference in two types of corrected predicted mean and true mean weights by age class for 1000 simulations.")
tabs("SimulationB25","Summary table with everything the same but b=2.5.")
tabs("SimulationB30","Summary table with everything the same but b=3.0.")
tabs("SimulationB35","Summary table with everything the same but b=3.5.")
tabs("SimulationS50","Summary table with everything the same but SDs at 50.")
tabs("SimulationS70","Summary table with everything the same but SDs at 70.")
```

----

## Introduction

Recently I was tasked with estimating mean weights at age for data that contained no weights, but did contain lengths and ages (ages were from applying an age-length key). A weight-length relationship was available (derived from a smaller sample from the same population). A question arose about whether the weight-length relationship should be used to predict weights for individual fish and then summarized to estimate mean weights at age or whether the weight-length relationship should be applied to summarized mean lengths at age to estimate mean weights at age.

This issue has been addressed in the literature. Ricker (1975; [page 211](http://www.dfo-mpo.gc.ca/Library/1485.pdf)) states that the true mean weight is always greater, "of the order of 5%," than the mean weight computed from the weight-length relationship with the mean length. Tesch (1971) suggested that the error in predicting mean weight at age with the weight-length relationship using mean length-at-age would be about 5-10%. In a simulation study, Nielsen and Schoch (1980) found that Tesch's suggestion was too general and that error was less than 10% when the coefficient of variation (CV; standard deviation divided by mean) in lengths was less than 10% but could be substantially higher when the CV was higher, with the specific result dependent on the weight-length regression exponent (b). [*Note that Nielsen and Schoch (1980) povide a nice geometric description of why this bias occurs.*] Pienaar and Ricker (1968) and Beyer (1991) both suggested corrections to reduce the bias in the mean weight at age produced by the weight-length regression using the mean length.

In this post, I quickly explore the bias in using the weight-length regression to estimate mean weight at age from mean length at age. I then quickly explore the correction factors suggested by Beyer (1991).

This post requires the `FSA` and `dplyr` packages.

```{r eval=FALSE}
library(FSA)
library(dplyr)
```

I also set the random number seed to make the results reproducible.
```{r}
set.seed(678394)
```


## Create A Sample of Data
I used the following code to create a very simple population that consisted of lengths, weights, and ages of fish. Lengths were modeled as normal distributions within each age-class. Weights were predicted directly from a known weight-length relationship without any error (in `wt1`) and with a small amount of error (in `wt2`). Modeling data in this way is simple, but at least somewhat realistic (`r figs("Explore1",display="cite")`).

```{r}
# Generate some lengths
ages <- 3:8
ns <- c(100,80,50,30,15,5)
mns <- c(300,450,525,560,575,590)
sds <- rep(30,length(mns))
lens <- NULL
for (i in 1:length(ages)) lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))

# Parameters of a weight-length relationship
loga <- -13.5
b <- 3.2

# Compute weights from the W-L relationship, w/ & w/o error
df <- data.frame(age=rep(ages,ns),len=round(lens,0)) %>%
  mutate(wt1=round(exp(loga+b*log(len)),0),
         wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))
headtail(df)
```

```{r MeanW-Explore1, echo=FALSE, fig.show='hold'}
lenlbl <- "Length (mm)"
wtlbl <- "Weight (g)"
agelbl <- "Age (years)"
par(mar=c(3,3,0.5,0.5),mgp=c(1.9,0.5,0),tcl=-0.2)
hist(~len,data=df,w=10,xlab=lenlbl)
hist(~wt1,data=df,w=25,xlab=wtlbl)
plot(wt2~len,data=df,pch=19,col=col2rgbt("black",1/8),xlab=lenlbl,ylab=wtlbl)
lines(wt1~len,data=df[order(df$len),],lwd=2)
plot(len~age,data=df,pch=19,col=col2rgbt("black",1/8),xlab=agelbl,ylab=lenlbl)
```

`r figs("Explore1")`


## Explore the Bias
The first two lines below (using `group_by()` and `summarize()`) compute the mean length (`mnlen`) and true mean weight (i.e., the weight for individuals modeled above; `true.mnwt`) for the weights without any error for each age. The next line (using `mutate()`) computes the predicted mean weight at each age using the weight-length regression coefficients and the mean lengths just computed. The fourth line computes the percentage error between the predicted and true mean weights for each age.

```{r Sum1}
sum1 <- group_by(df,age) %>%
  summarize(mnlen=mean(len),true.mnwt=mean(wt1)) %>%
  mutate(pr.mnwt=exp(loga+b*log(mnlen)),
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100) %>%
  as.data.frame()
```

The results from one example for the weights without any error show that the mean weight predicted from the mean length (`pr.mnwt`) is lower than the mean weight computed from individual weights predicted from individual lengths (`true.mnwt`; `r tabs("Sum1Tab",display="cite")`).

`r tabs("Sum1Tab")`

```{r Sum1Tab, echo=FALSE, comment="", background="white"}
print(sum1,row.names=FALSE,digits=2)
```

Of course, weight-length relationships are not without error, so the weights with a small amount of random error were used to determine if the pattern of a negative bias when predicting mean weights from mean lengths persists with more realistic data. [Note that only a small error was added because the relationship between weight and length is very strong for most fishes. The r-squared for this relationship was a realistic `r formatC(summary(lm(log(wt2)~log(len),data=df))$r.squared,format="f",digits=3)`.] Results from this one set of more realistic data showed a similar, though not as consistent, degree of negative bias when predicting mean weights from mean lengths (`r tabs("Sum2Tab",display="cite")`).

`r tabs("Sum2Tab")`

```{r Sum2Tab, echo=FALSE, comment="", background="white"}
sum2 <- group_by(df,age) %>%
  summarize(mnlen=mean(len),true.mnwt=mean(wt2)) %>%
  mutate(pr.mnwt=exp(loga+b*log(mnlen)),
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100) %>%
  as.data.frame()
print(sum2,row.names=FALSE,digits=2)
```

```{r echo=FALSE}
resamples <- 1000
pdres <- pdresn <- pdresl <- cvs <- matrix(0,nrow=resamples,ncol=length(ages))
colnames(pdres) <- colnames(pdresn) <- colnames(pdresl) <- paste0("age",ages)
for (j in 1:resamples) {
  lens <- NULL
  for (i in 1:length(ages)) lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))
  dfx <- data.frame(age=rep(ages,ns),len=round(lens,0)) %>%
    mutate(wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))
  sumx <- group_by(dfx,age) %>%
    summarize(n=n(),mnlen=mean(len),sdlen=sd(len),
              true.mnwt=mean(wt2)) %>%
  mutate(cvlen=sdlen/mnlen,
         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18
         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16
         pr.mnwt=exp(loga)*mnlen^b,
         pr.mnwt.n=pr.mnwt*cfn,
         pr.mnwt.l=pr.mnwt*cfl,
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,
         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,
         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) %>%
  select(-cfn,-cfl) %>%
  as.data.frame()
  pdres[j,] <- sumx$dif.mnwt
  pdresn[j,] <- sumx$dif.mnwt.n
  pdresl[j,] <- sumx$dif.mnwt.l
  cvs[j,] <- sumx$cvlen
}
```

I then performed the analysis above 1000 times, keeping track of the percent error between the predicted weight and the true mean weight for each age for each sample. The results of this simulation suggest an average negative bias near 4% for age-3 fish and between about 1 and 2% for all older fish (`r tabs("Simulation1",display="cite")`). Note that the CV in length for each age varied between `r formatC(100*min(cvs),format="f",digits=1)`% and  `r formatC(100*max(cvs),format="f",digits=1)`% in these simulations.

`r tabs("Simulation1")`

```{r Simulation1, echo=FALSE, comment="", background="white"}
print(colMeans(pdres),digits=2)
```

Similar patterns were found using different values of the weight-length relationship exponent b (see Appendix). However, larger negative biases were observed as the standard deviation in lengths increased (see Appendix).


## A Possible Correction
As noted above, Pienaar and Ricker (1968) and Beyer (1991) offered methods to reduce or eliminate the bias from using the weight-length regression to estimate mean weight at age from mean length at age. Beyer's corrections were simple as they were based on the CV of lengths and the b coefficient from the weight-length regression. Beyer specifically offered three possible bias correcting factors for isometric growth and allometric growth assuming lognormal and normal distributions for lengths. Here I will only consider Beyer's corrections for allometric growth with lognormal (i.e, [Beyer's equation 16](https://core.ac.uk/download/pdf/6389323.pdf)) and normal (i.e., [Beyer's equation 18](https://core.ac.uk/download/pdf/6389323.pdf)) distributions of lengths within age classes.

Beyer's formulae are implemented by modifying `group_by()` and `summarize()` used previously. Specifically the standard deviation of lengths is calculated (in `sdlen`) so that the CV of lengths can be calculated (in `cvlen`). The correction factors are then computed (in `cfn` for the normal distribution and `cfl` for the lognormal distribution).
```{r}
sum2a <- group_by(df,age) %>%
  summarize(mnlen=mean(len),sdlen=sd(len),
            true.mnwt=mean(wt2)) %>%
  mutate(cvlen=sdlen/mnlen,
         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18
         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16
         pr.mnwt=exp(loga)*mnlen^b,
         pr.mnwt.n=pr.mnwt*cfn,
         pr.mnwt.l=pr.mnwt*cfl,
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,
         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,
         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) %>%
  as.data.frame()
```

These calculations were again repeated 1000 tiems and summarized in the bottom two rows of `r tabs("Simulation2",display="cite")`. These results suggest that the mean bias in predicted weights at age when corrected with a correction factor appear to only be on the order of a quarter to a half a percent. These corrections seems to perform fairly consistently across a few different values of the weight-length regression exponent b and standard deviations in lengths (see Appendix).

`r tabs("Simulation2")`

```{r Simulation2, echo=FALSE, comment="", background="white"}
tmp <- rbind(colMeans(pdres),colMeans(pdresn),colMeans(pdresl))
rownames(tmp) <- c("No correction","Normal (eqn 18)","Lognormal (eqn 16)")
print(tmp,digits=2)
```


## Why Worry About This?
Why am I worried about this if the bias is on the order of 4% or less? First, for my application, we are estimating mean weight so that we can expand to total biomass. While a 4% error on an individual fish may seem inconsequential, that error can become quite important when expanded to represent total biomass, especially when it is a consistent negative bias.

So, why worry about correction factors when I can easily predict the weight for individual fish with the weight-length regression and then summarize these fish to get mean weight at age? In my situation, it appears that some of our mean lengths at age, and by extension mean weights at age, are poorly estimated because of small sample sizes at some ages. I am considering fitting a growth model (e.g., von Bertalanffy growth model) to the length-at-age data such that the fitted model can be used to predict mean lengths at age. The advantage of this is that information at other ages can be used to inform the calculation of mean length at an age. [*The potential downside, of course, is that I would be prescribing a smooth curve to the growth trajectory.*] If I can then estimate mean weights at age with minimal bias from the mean lengths at age from the growth model, then this could (I would need to test this) be beneficial in my situation.

## Summary
Mean weights at age appear to be estimated with bias when a weight-length relationship is applied to mean lengths at age without any correction factor. The correction factors suggested by Beyer (1991) are easy to implement and seem to reduce the bias in predicted mean weights-at-age to near negligible levels. Thus, if mean weights at age cannot be predicted from individual fish, then it may be possible to get reasonable estimates from the weight-length relationship and mean lengths at age.

----

## References

1. [Beyer, JE 1991. On length-weight relationships. Part 2. Computing mean weights from length statistics. FishByte 9:50-54.](http://pubs.iclarm.net/Naga/FB_2990.pdf)
1. [Nielsen, L.A. and W.F. Schoch. 1980. Errors in estimating mean weight and other statistics from mean length. Transactions of the American Fisheries Society 109:319-322.](http://afs.tandfonline.com/doi/abs/10.1577/1548-8659%281980%29109%3C319%3AEIEMWA%3E2.0.CO%3B2)
1. [Pienaar, L.V. and W.E. Ricker. 1968. Estimating mean weight fomr length statistics. Journal of the Fisheries Research Board of Canada 25:2743-2747.](http://www.nrcresearchpress.com/doi/abs/10.1139/f68-253?journalCode=jfrbc#.WYzmicaQyDI)
1. [Ricker, W.E. 1975. Computation and interpretation of biological statistics of fish populations. Bulletin of the Fisheries Research Board of Canada 25, Number 191.](http://www.dfo-mpo.gc.ca/Library/1485.pdf)
1. Tesch, F.W. 1971. Age and growth. Pages 98-126 in W.E. Ricker, editor. Methods for assessment of fish populations, 2nd edition. Blackwell Scientific Publications, Oxford, England.

----

## Appendix: Summaries Using Different Values of b and SDs

`r tabs("SimulationB25")`

```{r SimulationB25, echo=FALSE, comment="", background="white"}
b <- 2.5
pdres <- pdresn <- pdresl <- cvs <- matrix(0,nrow=resamples,ncol=length(ages))
colnames(pdres) <- colnames(pdresn) <- colnames(pdresl) <- paste0("age",ages)
for (j in 1:resamples) {
  lens <- NULL
  for (i in 1:length(ages)) lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))
  dfx <- data.frame(age=rep(ages,ns),len=round(lens,0)) %>%
    mutate(wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))
  sumx <- group_by(dfx,age) %>%
    summarize(n=n(),mnlen=mean(len),sdlen=sd(len),
              true.mnwt=mean(wt2)) %>%
  mutate(cvlen=sdlen/mnlen,
         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18
         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16
         pr.mnwt=exp(loga)*mnlen^b,
         pr.mnwt.n=pr.mnwt*cfn,
         pr.mnwt.l=pr.mnwt*cfl,
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,
         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,
         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) %>%
  select(-cfn,-cfl) %>%
  as.data.frame()
  pdres[j,] <- sumx$dif.mnwt
  pdresn[j,] <- sumx$dif.mnwt.n
  pdresl[j,] <- sumx$dif.mnwt.l
}
tmp <- rbind(colMeans(pdres),colMeans(pdresn),colMeans(pdresl))
rownames(tmp) <- c("No correction","Normal (eqn 18)","Lognormal (eqn 16)")
print(tmp,digits=2)
```

`r tabs("SimulationB30")`

```{r Simulation3, echo=FALSE, comment="", background="white"}
b <- 3
pdres <- pdresn <- pdresl <- cvs <- matrix(0,nrow=resamples,ncol=length(ages))
colnames(pdres) <- colnames(pdresn) <- colnames(pdresl) <- paste0("age",ages)
for (j in 1:resamples) {
  lens <- NULL
  for (i in 1:length(ages)) lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))
  dfx <- data.frame(age=rep(ages,ns),len=round(lens,0)) %>%
    mutate(wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))
  sumx <- group_by(dfx,age) %>%
    summarize(n=n(),mnlen=mean(len),sdlen=sd(len),
              true.mnwt=mean(wt2)) %>%
  mutate(cvlen=sdlen/mnlen,
         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18
         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16
         pr.mnwt=exp(loga)*mnlen^b,
         pr.mnwt.n=pr.mnwt*cfn,
         pr.mnwt.l=pr.mnwt*cfl,
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,
         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,
         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) %>%
  select(-cfn,-cfl) %>%
  as.data.frame()
  pdres[j,] <- sumx$dif.mnwt
  pdresn[j,] <- sumx$dif.mnwt.n
  pdresl[j,] <- sumx$dif.mnwt.l
}
tmp <- rbind(colMeans(pdres),colMeans(pdresn),colMeans(pdresl))
rownames(tmp) <- c("No correction","Normal (eqn 18)","Lognormal (eqn 16)")
print(tmp,digits=2)
```
`r tabs("SimulationB35")`

```{r SimulationB35, echo=FALSE, comment="", background="white"}
b <- 3.5
pdres <- pdresn <- pdresl <- cvs <- matrix(0,nrow=resamples,ncol=length(ages))
colnames(pdres) <- colnames(pdresn) <- colnames(pdresl) <- paste0("age",ages)
for (j in 1:resamples) {
  lens <- NULL
  for (i in 1:length(ages)) lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))
  dfx <- data.frame(age=rep(ages,ns),len=round(lens,0)) %>%
    mutate(wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))
  sumx <- group_by(dfx,age) %>%
    summarize(n=n(),mnlen=mean(len),sdlen=sd(len),
              true.mnwt=mean(wt2)) %>%
  mutate(cvlen=sdlen/mnlen,
         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18
         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16
         pr.mnwt=exp(loga)*mnlen^b,
         pr.mnwt.n=pr.mnwt*cfn,
         pr.mnwt.l=pr.mnwt*cfl,
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,
         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,
         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) %>%
  select(-cfn,-cfl) %>%
  as.data.frame()
  pdres[j,] <- sumx$dif.mnwt
  pdresn[j,] <- sumx$dif.mnwt.n
  pdresl[j,] <- sumx$dif.mnwt.l
}
tmp <- rbind(colMeans(pdres),colMeans(pdresn),colMeans(pdresl))
rownames(tmp) <- c("No correction","Normal (eqn 18)","Lognormal (eqn 16)")
print(tmp,digits=2)
```

`r tabs("SimulationS50")`

```{r SimulationS50, echo=FALSE, comment="", background="white"}
b <- 3.2
sds <- rep(50,length(mns))
pdres <- pdresn <- pdresl <- cvs <- matrix(0,nrow=resamples,ncol=length(ages))
colnames(pdres) <- colnames(pdresn) <- colnames(pdresl) <- paste0("age",ages)
for (j in 1:resamples) {
  lens <- NULL
  for (i in 1:length(ages)) lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))
  dfx <- data.frame(age=rep(ages,ns),len=round(lens,0)) %>%
    mutate(wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))
  sumx <- group_by(dfx,age) %>%
    summarize(n=n(),mnlen=mean(len),sdlen=sd(len),
              true.mnwt=mean(wt2)) %>%
  mutate(cvlen=sdlen/mnlen,
         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18
         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16
         pr.mnwt=exp(loga)*mnlen^b,
         pr.mnwt.n=pr.mnwt*cfn,
         pr.mnwt.l=pr.mnwt*cfl,
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,
         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,
         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) %>%
  select(-cfn,-cfl) %>%
  as.data.frame()
  pdres[j,] <- sumx$dif.mnwt
  pdresn[j,] <- sumx$dif.mnwt.n
  pdresl[j,] <- sumx$dif.mnwt.l
}
tmp <- rbind(colMeans(pdres),colMeans(pdresn),colMeans(pdresl))
rownames(tmp) <- c("No correction","Normal (eqn 18)","Lognormal (eqn 16)")
print(tmp,digits=2)
```

`r tabs("SimulationS70")`

```{r SimulationS70, echo=FALSE, comment="", background="white"}
b <- 3.2
sds <- rep(70,length(mns))
pdres <- pdresn <- pdresl <- cvs <- matrix(0,nrow=resamples,ncol=length(ages))
colnames(pdres) <- colnames(pdresn) <- colnames(pdresl) <- paste0("age",ages)
for (j in 1:resamples) {
  lens <- NULL
  for (i in 1:length(ages)) lens <- c(lens,rnorm(ns[i],mean=mns[i],sd=sds[i]))
  dfx <- data.frame(age=rep(ages,ns),len=round(lens,0)) %>%
    mutate(wt2=round(exp(loga+b*log(len)+rnorm(length(lens),mean=0,sd=0.1)),0))
  sumx <- group_by(dfx,age) %>%
    summarize(n=n(),mnlen=mean(len),sdlen=sd(len),
              true.mnwt=mean(wt2)) %>%
  mutate(cvlen=sdlen/mnlen,
         cfn=1+b*(b-1)/2*(cvlen^2),      # eqn 18
         cfl=(1+cvlen^2)^(b*(b-1)/2),    # eqn 16
         pr.mnwt=exp(loga)*mnlen^b,
         pr.mnwt.n=pr.mnwt*cfn,
         pr.mnwt.l=pr.mnwt*cfl,
         dif.mnwt=(pr.mnwt-true.mnwt)/true.mnwt*100,
         dif.mnwt.n=(pr.mnwt.n-true.mnwt)/true.mnwt*100,
         dif.mnwt.l=(pr.mnwt.l-true.mnwt)/true.mnwt*100) %>%
  select(-cfn,-cfl) %>%
  as.data.frame()
  pdres[j,] <- sumx$dif.mnwt
  pdresn[j,] <- sumx$dif.mnwt.n
  pdresl[j,] <- sumx$dif.mnwt.l
}
tmp <- rbind(colMeans(pdres),colMeans(pdresn),colMeans(pdresl))
rownames(tmp) <- c("No correction","Normal (eqn 18)","Lognormal (eqn 16)")
print(tmp,digits=2)
```

