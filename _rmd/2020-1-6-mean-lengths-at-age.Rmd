---
title: "Mean Lengths-At-Age"
layout: post
date: "January 6, 2020"
output:
  html_document
tags:
- R
- ggplot
- dplyr
- Growth

---
```{r eval=FALSE, echo=FALSE}
## FOR COMPILING FOR THE WEBSITE
## Make sure to setwd to source file location
source("rmd2md.R")
rmd2md("2020-1-6-mean-lengths-at-age")
```

```{r setup, echo=FALSE, results='hide', message=FALSE}
library(knitr)
knit_hooks$set(par1 = function(before, options, envir) {
  if (before) par(mar=c(3.5,3.5,1,1),mgp=c(2.1,0.4,0),tcl=-0.2)
})
opts_chunk$set(dev="png",tidy=FALSE,fig.width=4,fig.height=4,par1=TRUE)
options(show.signif.stars=FALSE)
set.seed(343434344)
```

----

## Introduction

```{r packages, message=FALSE, warning=FALSE}
library(FSAdata) # for data
library(FSA)     # for mapvalues(), se(), peek()
library(dplyr)   # for filter(), mutate(), group_by(), summarize()
library(ggplot2) # for plotting
```

XXX

Here I  use the lengths and ages of Lake Erie Walleye (*Sander vitreus*) captured during October-November, 2003-2014. These data are available in my [`FSAdata` package](https://github.com/droglenc/FSAdata) and formed many of the examples in Chapter 12 of the [**Age and Growth of Fishes: Principles and Techniques book**](https://derekogle.com/AGF/). My primary interest is in the `tl` (total length in mm) and `age` variables, though I will filter and summarize by `sex`, `loc`, and `year` below. [See here](https://derekogle.com/fishR/data/data-html/WalleyeErie2.html)) for more details on these data.

```{r data}
data(WalleyeErie2)
WalleyeErie2 <- WalleyeErie2 %>%
  mutate(loc=mapvalues(loc,from=1:3,
            to=c("Toledo-Huron","Huron-Fairport","Fairport-Conneaut")))
```

&nbsp;

## Create and Apply a Theme

```{r}
## New theme based on theme_bw()
theme_bw2 <- theme_bw() %+replace%
    theme(panel.grid=element_blank())

## Set theme for this session
theme_set(theme_bw2)
```


## One Sample


```{r}
wf12t <- filter(WalleyeErie2,sex=="female",year==2012,loc=="Toledo-Huron")
```

```{r}
mlaf12t <- wf12t %>%
  group_by(age) %>%
  summarize(n=n(),
            mntl=mean(tl),
            sdtl=sd(tl),
            setl=se(tl)) %>%
  mutate(lcitl=mntl+qt(0.025,df=n-1)*setl,
         ucitl=mntl+qt(0.975,df=n-1)*setl) %>%
  as.data.frame()
mlaf12t
```

A helper function ...
```{r}
summarize_lens <- function(d,x) {
  x <- rlang::enquo(x)
  suppressWarnings(
      d %>%
        summarize(n=n(),mntl=mean(!!x),
                  sdtl=sd(!!x),setl=se(!!x)) %>%
        mutate(lcitl=mntl+qt(0.025,df=n-1)*setl,
               ucitl=mntl+qt(0.975,df=n-1)*setl) %>%
        as.data.frame()
  )
}
```

```{r}
mlaf12t <- wf12t %>%
  group_by(age) %>%
  summarize_lens(tl)
mlaf12t
```


```{r mla_one, warning=FALSE}
ggplot(data=mlaf12t,aes(x=age,y=mntl)) +
  geom_point(size=1) +
  geom_line(col="gray90") +
  geom_errorbar(aes(ymin=lcitl,ymax=ucitl),width=0.3) +
  scale_x_continuous(name="Age (years)",limits=c(0,NA),breaks=seq(0,20,2),
                     expand=c(0.01,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05)))
```

```{r mla_one_2, warning=FALSE}
ggplot(data=wf12t,aes(x=age,y=tl)) +
  stat_summary(fun.y="mean",geom="point") +
  stat_summary(fun.y="mean",geom="line",color="gray90") +
  stat_summary(fun.data="mean_cl_normal",geom="errorbar",width=0.3,
               fun.args=list(conf.int=0.95)) +
  scale_x_continuous(name="Age (years)",limits=c(0,NA),breaks=seq(0,20,2),
                     expand=c(0.01,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05)))
```

## A Few Samples

```{r}
w12t <- filter(WalleyeErie2,year==2012,loc=="Toledo-Huron")
```

```{r}
mla12t <- w12t %>%
  group_by(sex,age) %>%
  summarize_lens(tl)
peek(mla12t,n=10)
```

```{r mla_two, warning=FALSE}
dodge_value <- 0.25
ggplot(data=mla12t,aes(x=age,y=mntl,group=sex,color=sex)) +
  geom_point(size=1,position=position_dodge(width=dodge_value)) +
  geom_line(alpha=0.1,position=position_dodge(width=dodge_value)) +
  geom_errorbar(aes(ymin=lcitl,ymax=ucitl),width=0.3,
                position=position_dodge(width=dodge_value)) +
  scale_x_continuous(name="Age (years)",limits=c(0,NA),breaks=seq(0,20,2),
                     expand=c(0.01,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05))) +
  scale_color_manual(values=c(c('#00429d', '#93003a'))) +
  theme(legend.position=c(0.8,0.2),
        legend.title=element_blank())
```



```{r}
wf12 <- filter(WalleyeErie2,sex=="female",year==2012)
mlaf12 <- wf12 %>%
  group_by(loc,age) %>%
  summarize_lens(tl)
peek(mlaf12,n=10)
```

```{r mla_three, warning=FALSE}
dodge_value <- 0.25
ggplot(data=mlaf12,aes(x=age,y=mntl,group=loc,color=loc)) +
  geom_point(size=1,position=position_dodge(width=dodge_value)) +
  geom_line(alpha=0.1,position=position_dodge(width=dodge_value)) +
  geom_errorbar(aes(ymin=lcitl,ymax=ucitl),width=0.3,
                position=position_dodge(width=dodge_value)) +
  scale_x_continuous(name="Age (years)",limits=c(0,NA),breaks=seq(0,20,2),
                     expand=c(0.01,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05))) +
  scale_color_brewer(palette="Dark2") +
  theme(legend.position=c(0.7,0.2),
        legend.title=element_blank())
```

&nbsp;

## A Few Samples by Two Variables

```{r}
w12 <- filter(WalleyeErie2,year==2012)
```

```{r}
mla12 <- w12 %>%
  group_by(loc,sex,age) %>%
  summarize_lens(tl)
peek(mla12,n=10)
```

```{r mla_wrap1, warning=FALSE, fig.height=8}
dodge_value <- 0.25
ggplot(data=mla12,aes(x=age,y=mntl,group=sex,color=sex)) +
  geom_point(size=1,position=position_dodge(width=dodge_value)) +
  geom_line(alpha=0.1,position=position_dodge(width=dodge_value)) +
  geom_errorbar(aes(ymin=lcitl,ymax=ucitl),width=0.3,
                position=position_dodge(width=dodge_value)) +
  scale_x_continuous(name="Age (years)",limits=c(0,NA),breaks=seq(0,20,4),
                     expand=c(0.01,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05))) +
  scale_color_manual(values=c(c('#00429d', '#93003a'))) +
  theme(legend.position="bottom",
        legend.title=element_blank()) +
  facet_wrap(vars(loc),ncol=1)
```


```{r mla_wrap2, warning=FALSE,fig.width=6,fig.height=4}
ggplot(data=mla12,aes(x=age,y=mntl)) +
  geom_point(size=1) +
  geom_line(alpha=0.1) +
  geom_errorbar(aes(ymin=lcitl,ymax=ucitl),width=0.3) +
  scale_x_continuous(name="Age (years)",limits=c(0,NA),breaks=seq(0,20,4),
                     expand=c(0.01,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05))) +
  facet_grid(cols=vars(loc),rows=vars(sex))
```

&nbsp;

## Several Samples


```{r}
wfT <- filter(WalleyeErie2,sex=="female",loc=="Toledo-Huron")
```

```{r}
mlafT <- wfT %>%
  group_by(year,age) %>%
  summarize_lens(tl)
peek(mlafT,n=10)
```

```{r mla_wrap3, warning=FALSE,fig.width=6,fig.height=8}
ggplot(data=mlafT,aes(x=age,y=mntl)) +
  geom_point(size=1) +
  geom_line(alpha=0.1) +
  geom_errorbar(aes(ymin=lcitl,ymax=ucitl),width=0.3) +
  scale_x_continuous(name="Age (years)",limits=c(0,NA),breaks=seq(0,20,4),
                     expand=c(0.01,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05))) +
  facet_wrap(vars(year),ncol=3)
```

```{r mla_wrap4, warning=FALSE}
ggplot(data=mlafT,aes(x=year,y=mntl,group=factor(age),color=factor(age))) +
  geom_point(size=1) +
  geom_line(alpha=0.1) +
#  geom_errorbar(aes(ymin=lcitl,ymax=ucitl),width=0.3) +
  scale_x_continuous(name="Year",breaks=2003:2014,expand=c(0.05,0)) +
  scale_y_continuous(name="Mean Total Length (mm)",limits=c(0,750),
                     expand=expand_scale(mult=c(0,0.05))) +
  theme(axis.text.x=element_text(angle=90,vjust=0.5),
        legend.position="none")
```


&nbsp;


## Final Thoughts

I am trying to post examples here as I learn `ggplot2`. My other `ggplot2`-related posts can be [found here](http://derekogle.com/fishR/blog/tags.html#ggplot).

&nbsp;

&nbsp;

## Footnotes

