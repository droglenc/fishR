<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Select (columns) Example</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<p><a href="http://had.co.nz/">Hadley Wickam</a> released the <strong>dplyr</strong> package in <a href="http://blog.rstudio.org/2014/01/17/introducing-dplyr/">January 2014</a>.  Since then I have been itching to give it a try as it has been suggested to speed up some data manipulations and, more important to me, provide a singular framework for a variety of common data manipulations.  Recently, I gave it a try with some simple common manipulations for fisheries work.  Below are my examples.</p>

<p>First, the <strong>dplyr</strong> package, <strong>plotrix</strong> (for the plot at the end), and the <strong>FSAdata</strong> package (for the data file) must be loaded.</p>

<pre><code class="r">library(dplyr)
library(FSAdata)
library(plotrix)
</code></pre>

<p>The <code>RuffeSLRH92</code> data frame is then loaded.</p>

<pre><code class="r">data(RuffeSLRH92)
str(RuffeSLRH92)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    738 obs. of  11 variables:
##  $ fish.id : num  1992 1992 1992 1992 1992 ...
##  $ month   : int  4 4 4 4 4 4 4 4 4 4 ...
##  $ day     : int  23 23 23 23 23 23 23 23 23 23 ...
##  $ year    : int  1992 1992 1992 1992 1992 1992 1992 1992 1992 1992 ...
##  $ species : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ location: int  160170 160170 160170 160170 160170 160170 160170 160170 160170 160170 ...
##  $ length  : int  90 128 112 68 56 58 111 111 115 65 ...
##  $ weight  : num  9.3 32.5 19 4.4 2.1 2.8 16.1 17.9 22.7 3.4 ...
##  $ sex     : Factor w/ 3 levels &quot;female&quot;,&quot;male&quot;,..: 2 1 2 2 3 2 2 2 2 1 ...
##  $ maturity: Factor w/ 11 levels &quot;developing&quot;,&quot;immature&quot;,..: 7 7 7 7 10 7 7 7 7 2 ...
##  $ age     : int  NA NA NA NA NA NA NA NA NA 1 ...
</code></pre>

<h2>Select (columns) Example</h2>

<p>Columns can be selected from a data.frame with <code>select()</code>, given the original data.frame as the first argument and the variables to select, or include, as further arguments.  The following creates a data.frame without the <code>fish.id</code>, <code>species</code>, <code>day</code> and <code>year</code> variables (they are not very useful in this context and will make the output further below easier to read).</p>

<pre><code class="r">RuffeSLRH92 &lt;- select(RuffeSLRH92,-fish.id,-species,-day,-year)
head(RuffeSLRH92)
</code></pre>

<pre><code>##   month location length weight     sex maturity age
## 1     4   160170     90    9.3    male     ripe  NA
## 2     4   160170    128   32.5  female     ripe  NA
## 3     4   160170    112   19.0    male     ripe  NA
## 4     4   160170     68    4.4    male     ripe  NA
## 5     4   160170     56    2.1 unknown  unknown  NA
## 6     4   160170     58    2.8    male     ripe  NA
</code></pre>

<p>The following creates a data.frame of just the length and weight variables.</p>

<pre><code class="r">ruffeLW &lt;- select(RuffeSLRH92,length,weight)
head(ruffeLW)
</code></pre>

<pre><code>##   length weight
## 1     90    9.3
## 2    128   32.5
## 3    112   19.0
## 4     68    4.4
## 5     56    2.1
## 6     58    2.8
</code></pre>

<p>The <strong>dplyr</strong> package contains a variety of helpers for selecting.  As one example, the following will select all variables that contains the letter &ldquo;l&rdquo;.</p>

<pre><code class="r">ruffeL &lt;- select(RuffeSLRH92,contains(&quot;l&quot;))
str(ruffeL)
</code></pre>

<pre><code>## &#39;data.frame&#39;:    738 obs. of  2 variables:
##  $ location: int  160170 160170 160170 160170 160170 160170 160170 160170 160170 160170 ...
##  $ length  : int  90 128 112 68 56 58 111 111 115 65 ...
</code></pre>

<h2>Filtering Example</h2>

<p>The <code>filter()</code> function can be used similarly to <code>subset()</code> to select a set of rows from an original data.frame according to some conditioning statement.  As with <code>subset()</code>, <code>filter()</code> returns an object that maintains a list of the original levels whether those levels exist in the new data.frame or not.  Use <code>droplevels()</code> to restrict the levels to only those that exist in the data.frame.  The example below finds just the males from the original data.frame.</p>

<pre><code class="r">male &lt;- filter(RuffeSLRH92,sex==&quot;male&quot;)
xtabs(~sex,data=male)
</code></pre>

<pre><code>## sex
##  female    male unknown 
##       0     201       0
</code></pre>

<pre><code class="r">male &lt;- droplevels(male)
xtabs(~sex,data=male)
</code></pre>

<pre><code>## sex
## male 
##  201
</code></pre>

<p>Multiple conditioning statements can be strung together as additional arguments to <code>filter()</code>.  The example below finds males that are also ripe.</p>

<pre><code class="r">maleripe &lt;- filter(RuffeSLRH92,sex==&quot;male&quot;,maturity==&quot;ripe&quot;)
xtabs(~sex+maturity,data=maleripe)
</code></pre>

<pre><code>##          maturity
## sex       developing immature mature nearly.ripe nearly.spent recovering
##   female           0        0      0           0            0          0
##   male             0        0      0           0            0          0
##   unknown          0        0      0           0            0          0
##          maturity
## sex       ripe running spent unknown yoy
##   female     0       0     0       0   0
##   male      63       0     0       0   0
##   unknown    0       0     0       0   0
</code></pre>

<p>So far, it seems that an &ldquo;or&rdquo; needs to be completed as with <code>subset()</code>.  For example, the following selects those fish that are male or are ripe.</p>

<pre><code class="r">maleripe2 &lt;- filter(RuffeSLRH92,sex==&quot;male&quot; | maturity==&quot;ripe&quot;)
xtabs(~sex+maturity,data=maleripe2)
</code></pre>

<pre><code>##          maturity
## sex       developing immature mature nearly.ripe nearly.spent recovering
##   female           0        0      0           0            0          0
##   male            29        5      5          21           14         10
##   unknown          0        0      0           0            0          0
##          maturity
## sex       ripe running spent unknown yoy
##   female   107       0     0       0   0
##   male      63      17    34       3   0
##   unknown    0       0     0       0   0
</code></pre>

<h2>Arrange Example</h2>

<p>The <code>arrange()</code> function can be used to order individuals.  The first argument is the data.frame and the following arguments are the variables to sort by.  The following sorts, in ascending order, the male data.frame created above by length.</p>

<pre><code class="r">malea &lt;- arrange(male,length)
head(malea)
</code></pre>

<pre><code>##   month location length weight  sex   maturity age
## 1     5   330040     45    1.4 male    unknown  NA
## 2    10   190170     47    1.3 male   immature  NA
## 3     9   120070     56    2.3 male developing  NA
## 4     4   370010     57    2.5 male       ripe  NA
## 5     4   160170     58    2.8 male       ripe  NA
## 6     5   340050     58    2.9 male     mature  NA
</code></pre>

<pre><code class="r">tail(malea)
</code></pre>

<pre><code>##     month location length weight  sex     maturity age
## 196     6    18007    153   43.4 male nearly.spent  NA
## 197     4    15011    154   48.7 male         ripe  NA
## 198     9    10060    155   41.0 male  nearly.ripe  NA
## 199     4    90060    161   54.0 male       mature  NA
## 200    10    60010    163   51.0 male       mature  NA
## 201     4    15011    183   82.8 male         ripe  NA
</code></pre>

<p>The following does the same but in descending order.</p>

<pre><code class="r">maled &lt;- arrange(male,desc(length))
head(maled)
</code></pre>

<pre><code>##   month location length weight  sex     maturity age
## 1     4    15011    183   82.8 male         ripe  NA
## 2    10    60010    163   51.0 male       mature  NA
## 3     4    90060    161   54.0 male       mature  NA
## 4     9    10060    155   41.0 male  nearly.ripe  NA
## 5     4    15011    154   48.7 male         ripe  NA
## 6     6    18007    153   43.4 male nearly.spent  NA
</code></pre>

<pre><code class="r">tail(maled)
</code></pre>

<pre><code>##     month location length weight  sex   maturity age
## 196     4   160170     58    2.8 male       ripe  NA
## 197     5   340050     58    2.9 male     mature  NA
## 198     4   370010     57    2.5 male       ripe  NA
## 199     9   120070     56    2.3 male developing  NA
## 200    10   190170     47    1.3 male   immature  NA
## 201     5   330040     45    1.4 male    unknown  NA
</code></pre>

<p>Multiple levels of ordering can be completed by including multiple variables as arguments to <code>arrange()</code>.  The following sorts the data by ascending length and then ascending weight.</p>

<pre><code class="r">ruffe2 &lt;- arrange(RuffeSLRH92,length,weight)
head(ruffe2)
</code></pre>

<pre><code>##   month location length weight     sex maturity age
## 1     7   360020     13    0.1 unknown      yoy  NA
## 2     8   170160     14    0.1 unknown      yoy  NA
## 3     7   160190     15    0.1 unknown      yoy  NA
## 4     7   320060     16    0.1 unknown      yoy  NA
## 5     7   170160     16    0.1 unknown      yoy  NA
## 6     7   300070     17    0.1 unknown      yoy  NA
</code></pre>

<pre><code class="r">tail(ruffe2)
</code></pre>

<pre><code>##     month location length weight    sex     maturity age
## 733     6    50090    178   57.4 female         ripe  NA
## 734     6    60070    180   55.1 female      running  NA
## 735     7    80090    180   63.3 female nearly.spent  NA
## 736     7    50030    180   72.6 female        spent  NA
## 737     4    15011    183   82.8   male         ripe  NA
## 738     7   320060    192   93.1 female nearly.spent  NA
</code></pre>

<h2>Add new variables (i.e., columns) Example</h2>

<p>The mutate() function can be used to add new variables to a data.frame.  It requires the original data.frame as the first argument and then arguments to create new variables as the remaining arguments.  The example below adds the natural log of length and weight to the data.frame created above that contains just the length and weight variables.</p>

<pre><code class="r">ruffeLW &lt;- mutate(ruffeLW,logL=log(length),logW=log(weight))
head(ruffeLW)
</code></pre>

<pre><code>##   length weight  logL   logW
## 1     90    9.3 4.500 2.2300
## 2    128   32.5 4.852 3.4812
## 3    112   19.0 4.718 2.9444
## 4     68    4.4 4.220 1.4816
## 5     56    2.1 4.025 0.7419
## 6     58    2.8 4.060 1.0296
</code></pre>

<h2>Aggregation and Summarization Example</h2>

<p>The <strong>dplyr</strong> package also provides functions that allow for simple aggregation of results.  The <code>group_by()</code> function first sets up how you want to group your data.  In the code below, the <code>byMon</code> data.frame is going to create groups by the <code>month</code> variable.  The <code>summarize()</code> function will then summarize a data.frame by the functions after the first argument.  The package also provides <code>n()</code> to count the number of individuals.  Thus, the example below will count the number of ruffe in the original data.frame by each month.</p>

<pre><code class="r">byMon &lt;- group_by(RuffeSLRH92,month)
( sumMon &lt;- summarize(byMon,count=n()) )
</code></pre>

<pre><code>## Source: local data frame [7 x 2]
## 
##   month count
## 1     4    62
## 2     5    66
## 3     6   154
## 4     7   182
## 5     8    79
## 6     9   126
## 7    10    69
</code></pre>

<p>The following counts the number of ruffe by each month and sex.</p>

<pre><code class="r">byMonSex &lt;- group_by(RuffeSLRH92,month,sex)
( sumMonSex &lt;- summarize(byMonSex,count=n()))
</code></pre>

<pre><code>## Source: local data frame [20 x 3]
## Groups: month
## 
##    month     sex count
## 1      4  female    30
## 2      4    male    30
## 3      4 unknown     2
## 4      5  female    35
## 5      5    male    31
## 6      6  female   114
## 7      6    male    38
## 8      6 unknown     2
## 9      7  female    96
## 10     7    male    20
## 11     7 unknown    66
## 12     8  female    28
## 13     8    male    18
## 14     8 unknown    33
## 15     9  female    68
## 16     9    male    39
## 17     9 unknown    19
## 18    10  female    36
## 19    10    male    25
## 20    10 unknown     8
</code></pre>

<p>Multiple functions can be used to create multiple summaries at once.  The following summarizes the number of fish and the mean and standard deviation of length by month.</p>

<pre><code class="r">( LenSumMon &lt;- summarize(byMon,n=n(),mn=mean(length),sd=sd(length)) )
</code></pre>

<pre><code>## Source: local data frame [7 x 4]
## 
##   month   n     mn    sd
## 1     4  62 111.37 35.42
## 2     5  66 112.41 35.60
## 3     6 154 113.62 31.61
## 4     7 182  93.55 50.55
## 5     8  79  82.22 40.80
## 6     9 126  98.76 39.15
## 7    10  69  98.72 39.16
</code></pre>

<h2>Putting It All Together</h2>

<p>Finally, all of the functions described above can be strung together with the <code>%.%</code> operator.  This is best shown with an example.  The following set of code will compute the proportion of all captured fish captured in each month by (1) grouping the data by month, (2) summarizing the number per month, (3) adding a new variable that is the proportion of the total catch in each month, and then (4) sorting the results such that the month with the largest catch is listed first.</p>

<pre><code class="r">fnl1 &lt;- RuffeSLRH92 %.%
  group_by(month) %.%
  summarize(n=n()) %.%
  mutate(prop.catch=n/sum(n)) %.%
  arrange(desc(prop.catch))
fnl1
</code></pre>

<pre><code>## Source: local data frame [7 x 3]
## 
##   month   n prop.catch
## 1     7 182    0.24661
## 2     6 154    0.20867
## 3     9 126    0.17073
## 4     8  79    0.10705
## 5    10  69    0.09350
## 6     5  66    0.08943
## 7     4  62    0.08401
</code></pre>

<p>The following example constructs a data.frame (that is then used to construct a plot) that contains the mean, sd, se, and approximate 95% confidence interval for length by month.</p>

<pre><code class="r">fnl2 &lt;- RuffeSLRH92 %.%
  group_by(month) %.%
  summarize(n=n(),mn=mean(length),sd=sd(length)) %.%
  mutate(se=sd/sqrt(n),LCI=mn+qnorm(0.025)*se,UCI=mn+qnorm(0.975)*se)
fnl2
</code></pre>

<pre><code>## Source: local data frame [7 x 7]
## 
##   month   n     mn    sd    se    LCI    UCI
## 1     4  62 111.37 35.42 4.498 102.55 120.19
## 2     5  66 112.41 35.60 4.382 103.82 121.00
## 3     6 154 113.62 31.61 2.547 108.63 118.62
## 4     7 182  93.55 50.55 3.747  86.21 100.90
## 5     8  79  82.22 40.80 4.590  73.22  91.21
## 6     9 126  98.76 39.15 3.488  91.93 105.60
## 7    10  69  98.72 39.16 4.714  89.48 107.96
</code></pre>

<pre><code class="r">with(fnl2,plotCI(month,mn,ui=UCI,li=LCI,pch=16,ylab=&quot;Length (mm)&quot;,xlab=&quot;Month&quot;))
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk RuffeMeanLength"/> </p>

<h2>Final Thoughts</h2>

<p>The <strong>dplyr</strong> package appears to have many more useful functions.  This first foray suggests to me that it is going to be a useful &ldquo;grammar&rdquo; for simplifying data manipulations.  I will post more as I explore it more.  In the meantime, let me know what your experience with <strong>dplyr</strong> is.</p>

</body>

</html>

